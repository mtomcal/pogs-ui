"use strict";angular.module("pogsUiApp",["ui","ui.bootstrap","ngResource","ngSanitize"]).config(function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/pog/:id",{templateUrl:"views/pog.html",controller:"PogCtrl"}).otherwise({redirectTo:"/"})}),angular.module("pogsUiApp").controller("MainCtrl",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("pogsUiApp").controller("PogCtrl",function(a,b,c,d,e,f,g,h,i,j,k){a.loadedBlast=!1,a.loadedOrtho=!1,a.loadedGroup=!1,a.loadedTree=!1,a.genemodels=[],a.urlmap=function(a){var b="",c={rice:[/()(Os[\w|\d]+\.+[\w|\d]+)()()/,"http://rice.plantbiology.msu.edu/cgi-bin/ORF_infopage.cgi?orf="],poplar:[/()(POPTR\_[\w|\d]+)(\.+)([\w|\d]+)/,"http://www.gramene.org/Populus_trichocarpa/Gene/Summary?g="],arab:[/()(AT[\w|\d]+)(\.+)([\w|\d]+)/,"http://www.arabidopsis.org/servlets/TairObject?type=locus&name="],maize:[/()(GRMZM[\w|\d]+)(\_)([\w|\d]+)/,"http://www.maizesequence.org/Zea_mays/Gene?db=core;g="],acmaize:[/()(AC[\.|\d|_|\w]+)()/,"http://www.maizesequence.org/Zea_mays/Gene?db=core;g="]};return _.each(c,function(c,d){var e=a.match(c[0]);"rice"!=d||_.isNull(e)||(e[2]="LOC_"+e[2]),e&&(b=c[1]+e[2])}),b},a.orgdata=[],a.pog=c.query({id:b.id},function(b){_.each(b.locus,function(b){_.each(b.organismdatum,function(b,c){a.genemodels.push(c),a.orgdata.push(b)})}),a.loadedGroup=!0}),a.domains=d.query({id:b.id},function(b){return a.loadedOrtho=!0,WZ_Tooltip(),b}),a.blast_domains={},a.loadBlastDomains=function(){0==a.loadedBlast&&(a.blast_domains=e.query({id:b.id},function(){a.loadedBlast=!0}))};var l=function(b,c){var d="http://cas-pogs.uoregon.edu/ui/",e=angular.element(b);e.find("branch_length").each(function(){angular.element(this).text("1")}),e.find("name").each(function(){if(_.include(a.genemodels,angular.element(this).text())){var b=angular.element(this).text();angular.element(this).text(b+"*")}else{var c=angular.element("<annotation><desc>Click to Search For "+angular.element(this).text()+" POG</desc><uri>"+d+"pogs/search/?tid="+angular.element(this).text()+"&type=byPOG</uri></annotation>");angular.element(this).parent().append(c)}}),c(e[2].outerHTML)};a.loadTree=function(){a.loadedTree||k.query({id:b.id},function(c){l(c[b.id],function(b){var c={phyloxml:b,fileSource:!1};new Smits.PhyloCanvas(c,"svgCanvas",900,1e3),a.loadedTree=!0})})},a.prednls=h.query({id:b.id}),a.nucpred=j.query({id:b.id}),a.predotar=f.query({id:b.id}),a.targetp=g.query({id:b.id}),a.ppdb=i.query({id:b.id})}),angular.module("pogsUiApp").factory("Pog",function(a){return a("http://cas-pogs.uoregon.edu/dev/api/pog.jsonp",{id:"@id",alt:"json",callback:"JSON_CALLBACK"},{query:{method:"JSONP",query:{},cache:!0}})}),angular.module("pogsUiApp").factory("Domains",function(a){return a("http://cas-pogs.uoregon.edu/dev/api/domains.jsonp",{id:"@id",alt:"json",callback:"JSON_CALLBACK"},{query:{method:"JSONP",query:{},cache:!0}})}),angular.module("pogsUiApp").factory("Nucpred",function(a){return a("http://cas-pogs.uoregon.edu/dev/api/nucpred.jsonp",{id:"@id",alt:"json",callback:"JSON_CALLBACK"},{query:{method:"JSONP",isArray:!0,query:{},cache:!0}})}),angular.module("pogsUiApp").factory("Targetp",function(a){return a("http://cas-pogs.uoregon.edu/dev/api/targetp.jsonp",{id:"@id",alt:"json",callback:"JSON_CALLBACK"},{query:{method:"JSONP",isArray:!0,query:{},cache:!0}})}),angular.module("pogsUiApp").factory("Predotar",function(a){return a("http://cas-pogs.uoregon.edu/dev/api/predotar.jsonp",{id:"@id",alt:"json",callback:"JSON_CALLBACK"},{query:{method:"JSONP",isArray:!0,query:{},cache:!0}})}),angular.module("pogsUiApp").factory("Prednls",function(a){return a("http://cas-pogs.uoregon.edu/dev/api/prednls.jsonp",{id:"@id",alt:"json",callback:"JSON_CALLBACK"},{query:{method:"JSONP",isArray:!0,query:{},cache:!0}})}),angular.module("pogsUiApp").factory("Ppdb",function(a){return a("http://cas-pogs.uoregon.edu/dev/api/ppdb.jsonp",{id:"@id",alt:"json",callback:"JSON_CALLBACK"},{query:{method:"JSONP",isArray:!0,query:{},cache:!0}})}),angular.module("pogsUiApp").factory("BlastDomains",function(a){return a("http://cas-pogs.uoregon.edu/dev/api/blast_domains.jsonp",{id:"@id",alt:"json",callback:"JSON_CALLBACK"},{query:{method:"JSONP",query:{},cache:!0}})}),angular.module("pogsUiApp").factory("Tree",function(a){return a("http://cas-pogs.uoregon.edu/dev/api/tree.jsonp",{id:"@id",alt:"json",callback:"JSON_CALLBACK"},{query:{method:"JSONP",query:{},cache:!0}})});var WZ_Tooltip=function(){function Tip(){tt_Tip(arguments,null)}function TagToTip(){var a=tt_GetElt(arguments[0]);a&&tt_Tip(arguments,a)}function UnTip(){tt_OpReHref(),tt_aV[DURATION]<0&&2&tt_iState?tt_tDurt.Timer("tt_HideInit()",-tt_aV[DURATION],!0):tt_aV[STICKY]&&2&tt_iState||tt_HideInit()}function tt_Extension(){return tt_ExtCmdEnum(),tt_aExt[tt_aExt.length]=this,this}function tt_SetTipPos(a,b){var c=tt_aElt[0].style;if(tt_x=a,tt_y=b,c.left=a+"px",c.top=b+"px",tt_ie56){var d=tt_aElt[tt_aElt.length-1];d&&(d.style.left=c.left,d.style.top=c.top)}}function tt_HideInit(){if(tt_iState){if(tt_ExtCallFncs(0,"HideInit"),tt_iState&=-13,tt_flagOpa&&tt_aV[FADEOUT]&&(tt_tFade.EndTimer(),tt_opa)){var a=Math.round(tt_aV[FADEOUT]/(tt_aV[FADEINTERVAL]*(tt_aV[OPACITY]/tt_opa)));return tt_Fade(tt_opa,tt_opa,0,a),void 0}tt_tHide.Timer("tt_Hide();",1,!1)}}function tt_Hide(){tt_db&&tt_iState&&(tt_OpReHref(),2&tt_iState&&(tt_aElt[0].style.visibility="hidden",tt_ExtCallFncs(0,"Hide")),tt_tShow.EndTimer(),tt_tHide.EndTimer(),tt_tDurt.EndTimer(),tt_tFade.EndTimer(),tt_op||tt_ie||(tt_tWaitMov.EndTimer(),tt_bWait=!1),(tt_aV[CLICKCLOSE]||tt_aV[CLICKSTICKY])&&tt_RemEvtFnc(document,"mouseup",tt_OnLClick),tt_ExtCallFncs(0,"Kill"),tt_t2t&&!tt_aV[COPYCONTENT]&&tt_UnEl2Tip(),tt_iState=0,tt_over=null,tt_ResetMainDiv(),tt_aElt[tt_aElt.length-1]&&(tt_aElt[tt_aElt.length-1].style.display="none"))}function tt_GetElt(a){return document.getElementById?document.getElementById(a):document.all?document.all[a]:null}function tt_GetDivW(a){return a?a.offsetWidth||a.style.pixelWidth||0:0}function tt_GetDivH(a){return a?a.offsetHeight||a.style.pixelHeight||0:0}function tt_GetScrollX(){return window.pageXOffset||(tt_db?tt_db.scrollLeft||0:0)}function tt_GetScrollY(){return window.pageYOffset||(tt_db?tt_db.scrollTop||0:0)}function tt_GetClientW(){return tt_GetWndCliSiz("Width")}function tt_GetClientH(){return tt_GetWndCliSiz("Height")}function tt_GetEvtX(a){return a?typeof a.pageX!=tt_u?a.pageX:a.clientX+tt_GetScrollX():0}function tt_GetEvtY(a){return a?typeof a.pageY!=tt_u?a.pageY:a.clientY+tt_GetScrollY():0}function tt_AddEvtFnc(a,b,c){a&&(a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c))}function tt_RemEvtFnc(a,b,c){a&&(a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c))}function tt_GetDad(a){return a.parentNode||a.parentElement||a.offsetParent}function tt_MovDomNode(a,b,c){b&&b.removeChild(a),c&&c.appendChild(a)}function tt_Init(){tt_MkCmdEnum(),tt_Browser()&&tt_MkMainDiv()&&(tt_IsW3cBox(),tt_OpaSupport(),tt_AddEvtFnc(document,"mousemove",tt_Move),(TagsToTip||tt_Debug)&&tt_SetOnloadFnc(),tt_AddEvtFnc(window,"unload",tt_Hide))}function tt_MkCmdEnum(){var n=0;for(var i in config)eval("window."+i.toString().toUpperCase()+" = "+n++);tt_aV.length=n}function tt_Browser(){var n,nv,n6,w3c;if(n=navigator.userAgent.toLowerCase(),nv=navigator.appVersion,tt_op=document.defaultView&&typeof eval("window.opera")!=tt_u,tt_ie=-1!=n.indexOf("msie")&&document.all&&!tt_op){var ieOld=!document.compatMode||"BackCompat"==document.compatMode;tt_db=ieOld?document.body||null:document.documentElement,tt_db&&(tt_ie56=parseFloat(nv.substring(nv.indexOf("MSIE")+5))>=5.5&&typeof document.body.style.maxHeight==tt_u)}else tt_db=document.documentElement||document.body||(document.getElementsByTagName?document.getElementsByTagName("body")[0]:null),tt_op||(n6=document.defaultView&&typeof document.defaultView.getComputedStyle!=tt_u,w3c=!n6&&document.getElementById);if(tt_body=document.getElementsByTagName?document.getElementsByTagName("body")[0]:document.body||null,tt_ie||n6||tt_op||w3c)if(tt_body&&tt_db){if(document.attachEvent||document.addEventListener)return!0}else tt_Err("wz_tooltip.js must be included INSIDE the body section, immediately after the opening <body> tag.",!1);return tt_db=null,!1}function tt_MkMainDiv(){return tt_body.insertAdjacentHTML?tt_body.insertAdjacentHTML("afterBegin",tt_MkMainDivHtm()):typeof tt_body.innerHTML!=tt_u&&document.createElement&&tt_body.appendChild&&tt_body.appendChild(tt_MkMainDivDom()),window.tt_GetMainDivRefs&&tt_GetMainDivRefs()?!0:(tt_db=null,!1)}function tt_MkMainDivHtm(){return'<div id="WzTtDiV"></div>'+(tt_ie56?'<iframe id="WzTtIfRm" src="javascript:false" scrolling="no" frameborder="0" style="filter:Alpha(opacity=0);position:absolute;top:0px;left:0px;display:none;"></iframe>':"")}function tt_MkMainDivDom(){var a=document.createElement("div");return a&&(a.id="WzTtDiV"),a}function tt_GetMainDivRefs(){if(tt_aElt[0]=tt_GetElt("WzTtDiV"),tt_ie56&&tt_aElt[0]&&(tt_aElt[tt_aElt.length-1]=tt_GetElt("WzTtIfRm"),tt_aElt[tt_aElt.length-1]||(tt_aElt[0]=null)),tt_aElt[0]){var a=tt_aElt[0].style;return a.visibility="hidden",a.position="absolute",a.overflow="hidden",!0}return!1}function tt_ResetMainDiv(){tt_SetTipPos(0,0),tt_aElt[0].innerHTML="",tt_aElt[0].style.width="0px",tt_h=0}function tt_IsW3cBox(){var a=tt_aElt[0].style;a.padding="10px",a.width="40px",tt_bBoxOld=40==tt_GetDivW(tt_aElt[0]),a.padding="0px",tt_ResetMainDiv()}function tt_OpaSupport(){var a=tt_body.style;tt_flagOpa=typeof a.KhtmlOpacity!=tt_u?2:typeof a.KHTMLOpacity!=tt_u?3:typeof a.MozOpacity!=tt_u?4:typeof a.opacity!=tt_u?5:typeof a.filter!=tt_u?1:0}function tt_SetOnloadFnc(){if(tt_AddEvtFnc(document,"DOMContentLoaded",tt_HideSrcTags),tt_AddEvtFnc(window,"load",tt_HideSrcTags),tt_body.attachEvent&&tt_body.attachEvent("onreadystatechange",function(){"complete"==tt_body.readyState&&tt_HideSrcTags()}),/WebKit|KHTML/i.test(navigator.userAgent))var a=setInterval(function(){/loaded|complete/.test(document.readyState)&&(clearInterval(a),tt_HideSrcTags())},10)}function tt_HideSrcTags(){window.tt_HideSrcTags&&!window.tt_HideSrcTags.done&&(window.tt_HideSrcTags.done=!0,tt_HideSrcTagsRecurs(tt_body)||tt_Err("There are HTML elements to be converted to tooltips.\nIf you want these HTML elements to be automatically hidden, you must edit wz_tooltip.js, and set TagsToTip in the global tooltip configuration to true.",!0))}function tt_HideSrcTagsRecurs(a){for(var b,c,d=a.childNodes||a.children||null,e=d?d.length:0;e;){if(--e,!tt_HideSrcTagsRecurs(d[e]))return!1;if(b=d[e].getAttribute?d[e].getAttribute("onmouseover")||d[e].getAttribute("onclick"):"function"==typeof d[e].onmouseover?d[e].onmouseover||d[e].onclick:null,b&&(c=b.toString().match(/TagToTip\s*\(\s*'[^'.]+'\s*[\),]/),c&&c.length&&!tt_HideSrcTag(c[0])))return!1}return!0}function tt_HideSrcTag(a){var b,c;if(b=a.replace(/.+'([^'.]+)'.+/,"$1"),c=tt_GetElt(b)){if(tt_Debug&&!TagsToTip)return!1;c.style.display="none"}else tt_Err("Invalid ID\n'"+b+"'\npassed to TagToTip()."+" There exists no HTML element with that ID.",!0);return!0}function tt_Tip(a,b){!tt_db||8&tt_iState||(tt_iState&&tt_Hide(),tt_Enabled&&(tt_t2t=b,tt_ReadCmds(a)&&(tt_iState=5,tt_AdaptConfig1(),tt_MkTipContent(a),tt_MkTipSubDivs(),tt_FormatTip(),tt_bJmpVert=!1,tt_bJmpHorz=!1,tt_maxPosX=tt_GetClientW()+tt_GetScrollX()-tt_w-1,tt_maxPosY=tt_GetClientH()+tt_GetScrollY()-tt_h-1,tt_AdaptConfig2(),tt_OverInit(),tt_ShowInit(),tt_Move())))}function tt_ReadCmds(a){var b;b=0;for(var c in config)tt_aV[b++]=config[c];if(1&a.length){for(b=a.length-1;b>0;b-=2)tt_aV[a[b-1]]=a[b];return!0}return tt_Err("Incorrect call of Tip() or TagToTip().\nEach command must be followed by a value.",!0),!1}function tt_AdaptConfig1(){if(tt_ExtCallFncs(0,"LoadConfig"),tt_aV[TITLEBGCOLOR].length||(tt_aV[TITLEBGCOLOR]=tt_aV[BORDERCOLOR]),tt_aV[TITLEFONTCOLOR].length||(tt_aV[TITLEFONTCOLOR]=tt_aV[BGCOLOR]),tt_aV[TITLEFONTFACE].length||(tt_aV[TITLEFONTFACE]=tt_aV[FONTFACE]),tt_aV[TITLEFONTSIZE].length||(tt_aV[TITLEFONTSIZE]=tt_aV[FONTSIZE]),tt_aV[CLOSEBTN]){tt_aV[CLOSEBTNCOLORS]||(tt_aV[CLOSEBTNCOLORS]=new Array("","","",""));for(var a=4;a;)--a,tt_aV[CLOSEBTNCOLORS][a].length||(tt_aV[CLOSEBTNCOLORS][a]=1&a?tt_aV[TITLEFONTCOLOR]:tt_aV[TITLEBGCOLOR]);tt_aV[TITLE].length||(tt_aV[TITLE]=" ")}100!=tt_aV[OPACITY]||typeof tt_aElt[0].style.MozOpacity==tt_u||Array.every||(tt_aV[OPACITY]=99),tt_aV[FADEIN]&&tt_flagOpa&&tt_aV[DELAY]>100&&(tt_aV[DELAY]=Math.max(tt_aV[DELAY]-tt_aV[FADEIN],100))}function tt_AdaptConfig2(){tt_aV[CENTERMOUSE]&&(tt_aV[OFFSETX]-=tt_w-(tt_aV[SHADOW]?tt_aV[SHADOWWIDTH]:0)>>1,tt_aV[JUMPHORZ]=!1)}function tt_MkTipContent(a){tt_sContent=tt_t2t?tt_aV[COPYCONTENT]?tt_t2t.innerHTML:"":a[0],tt_ExtCallFncs(0,"CreateContentString")}function tt_MkTipSubDivs(){var a="position:relative;margin:0px;padding:0px;border-width:0px;left:0px;top:0px;line-height:normal;width:auto;",b=' cellspacing="0" cellpadding="0" border="0" style="'+a+'"><tbody style="'+a+'"><tr><td ';tt_aElt[0].style.width=tt_GetClientW()+"px",tt_aElt[0].innerHTML=""+(tt_aV[TITLE].length?'<div id="WzTiTl" style="position:relative;z-index:1;"><table id="WzTiTlTb"'+b+'id="WzTiTlI" style="'+a+'">'+tt_aV[TITLE]+"</td>"+(tt_aV[CLOSEBTN]?'<td align="right" style="'+a+'text-align:right;">'+'<span id="WzClOsE" style="position:relative;left:2px;padding-left:2px;padding-right:2px;'+"cursor:"+(tt_ie?"hand":"pointer")+';" onmouseover="tt_OnCloseBtnOver(1)" onmouseout="tt_OnCloseBtnOver(0)" onclick="tt_HideInit()">'+tt_aV[CLOSEBTNTEXT]+"</span></td>":"")+"</tr></tbody></table></div>":"")+'<div id="WzBoDy" style="position:relative;z-index:0;">'+"<table"+b+'id="WzBoDyI" style="'+a+'">'+tt_sContent+"</td></tr></tbody></table></div>"+(tt_aV[SHADOW]?'<div id="WzTtShDwR" style="position:absolute;overflow:hidden;"></div><div id="WzTtShDwB" style="position:relative;overflow:hidden;"></div>':""),tt_GetSubDivRefs(),tt_t2t&&!tt_aV[COPYCONTENT]&&tt_El2Tip(),tt_ExtCallFncs(0,"SubDivsCreated")}function tt_GetSubDivRefs(){for(var a=new Array("WzTiTl","WzTiTlTb","WzTiTlI","WzClOsE","WzBoDy","WzBoDyI","WzTtShDwB","WzTtShDwR"),b=a.length;b;--b)tt_aElt[b]=tt_GetElt(a[b-1])}function tt_FormatTip(){var a,b,c,d,e,f=tt_aV[PADDING],g=tt_aV[BORDERWIDTH],h=f+g<<1;tt_aV[TITLE].length?(c=tt_aV[TITLEPADDING],a=tt_aElt[1].style,a.background=tt_aV[TITLEBGCOLOR],a.paddingTop=a.paddingBottom=c+"px",a.paddingLeft=a.paddingRight=c+2+"px",a=tt_aElt[3].style,a.color=tt_aV[TITLEFONTCOLOR],-1==tt_aV[WIDTH]&&(a.whiteSpace="nowrap"),a.fontFamily=tt_aV[TITLEFONTFACE],a.fontSize=tt_aV[TITLEFONTSIZE],a.fontWeight="bold",a.textAlign=tt_aV[TITLEALIGN],tt_aElt[4]&&(a=tt_aElt[4].style,a.background=tt_aV[CLOSEBTNCOLORS][0],a.color=tt_aV[CLOSEBTNCOLORS][1],a.fontFamily=tt_aV[TITLEFONTFACE],a.fontSize=tt_aV[TITLEFONTSIZE],a.fontWeight="bold"),tt_aV[WIDTH]>0?tt_w=tt_aV[WIDTH]:(tt_w=tt_GetDivW(tt_aElt[3])+tt_GetDivW(tt_aElt[4]),tt_aElt[4]&&(tt_w+=f),tt_aV[WIDTH]<-1&&tt_w>-tt_aV[WIDTH]&&(tt_w=-tt_aV[WIDTH])),d=-g):(tt_w=0,d=0),a=tt_aElt[5].style,a.top=d+"px",g&&(a.borderColor=tt_aV[BORDERCOLOR],a.borderStyle=tt_aV[BORDERSTYLE],a.borderWidth=g+"px"),tt_aV[BGCOLOR].length&&(a.background=tt_aV[BGCOLOR]),tt_aV[BGIMG].length&&(a.backgroundImage="url("+tt_aV[BGIMG]+")"),a.padding=f+"px",a.textAlign=tt_aV[TEXTALIGN],tt_aV[HEIGHT]&&(a.overflow="auto",tt_aV[HEIGHT]>0?a.height=tt_aV[HEIGHT]+h+"px":tt_h=h-tt_aV[HEIGHT]),a=tt_aElt[6].style,a.color=tt_aV[FONTCOLOR],a.fontFamily=tt_aV[FONTFACE],a.fontSize=tt_aV[FONTSIZE],a.fontWeight=tt_aV[FONTWEIGHT],a.textAlign=tt_aV[TEXTALIGN],tt_aV[WIDTH]>0?b=tt_aV[WIDTH]:-1==tt_aV[WIDTH]&&tt_w?b=tt_w:(b=tt_GetDivW(tt_aElt[6]),tt_aV[WIDTH]<-1&&b>-tt_aV[WIDTH]&&(b=-tt_aV[WIDTH])),b>tt_w&&(tt_w=b),tt_w+=h,tt_aV[SHADOW]?(tt_w+=tt_aV[SHADOWWIDTH],e=Math.floor(4*tt_aV[SHADOWWIDTH]/3),a=tt_aElt[7].style,a.top=d+"px",a.left=e+"px",a.width=tt_w-e-tt_aV[SHADOWWIDTH]+"px",a.height=tt_aV[SHADOWWIDTH]+"px",a.background=tt_aV[SHADOWCOLOR],a=tt_aElt[8].style,a.top=e+"px",a.left=tt_w-tt_aV[SHADOWWIDTH]+"px",a.width=tt_aV[SHADOWWIDTH]+"px",a.background=tt_aV[SHADOWCOLOR]):e=0,tt_SetTipOpa(tt_aV[FADEIN]?0:tt_aV[OPACITY]),tt_FixSize(d,e)}function tt_FixSize(a,b){var c,d,e,f,g=tt_aV[PADDING],h=tt_aV[BORDERWIDTH];tt_aElt[0].style.width=tt_w+"px",tt_aElt[0].style.pixelWidth=tt_w,d=tt_w-(tt_aV[SHADOW]?tt_aV[SHADOWWIDTH]:0),c=d,tt_bBoxOld||(c-=g+h<<1),tt_aElt[5].style.width=c+"px",tt_aElt[1]&&(c=d-(tt_aV[TITLEPADDING]+2<<1),tt_bBoxOld||(d=c),tt_aElt[1].style.width=d+"px",tt_aElt[2].style.width=c+"px"),tt_h&&(e=tt_GetDivH(tt_aElt[5]),e>tt_h&&(tt_bBoxOld||(tt_h-=g+h<<1),tt_aElt[5].style.height=tt_h+"px")),tt_h=tt_GetDivH(tt_aElt[0])+a,tt_aElt[8]&&(tt_aElt[8].style.height=tt_h-b+"px"),f=tt_aElt.length-1,tt_aElt[f]&&(tt_aElt[f].style.width=tt_w+"px",tt_aElt[f].style.height=tt_h+"px")}function tt_DeAlt(a){var b;if(a&&(a.alt&&(a.alt=""),a.title&&(a.title=""),b=a.childNodes||a.children||null))for(var c=b.length;c;)tt_DeAlt(b[--c])}function tt_OpDeHref(a){if(tt_op)for(tt_elDeHref&&tt_OpReHref();a;){if(a.hasAttribute&&a.hasAttribute("href")){a.t_href=a.getAttribute("href"),a.t_stats=window.status,a.removeAttribute("href"),a.style.cursor="hand",tt_AddEvtFnc(a,"mousedown",tt_OpReHref),window.status=a.t_href,tt_elDeHref=a;break}a=tt_GetDad(a)}}function tt_OpReHref(){tt_elDeHref&&(tt_elDeHref.setAttribute("href",tt_elDeHref.t_href),tt_RemEvtFnc(tt_elDeHref,"mousedown",tt_OpReHref),window.status=tt_elDeHref.t_stats,tt_elDeHref=null)}function tt_El2Tip(){var a=tt_t2t.style;tt_t2t.t_cp=a.position,tt_t2t.t_cl=a.left,tt_t2t.t_ct=a.top,tt_t2t.t_cd=a.display,tt_t2tDad=tt_GetDad(tt_t2t),tt_MovDomNode(tt_t2t,tt_t2tDad,tt_aElt[6]),a.display="block",a.position="static",a.left=a.top=a.marginLeft=a.marginTop="0px"}function tt_UnEl2Tip(){var a=tt_t2t.style;a.display=tt_t2t.t_cd,tt_MovDomNode(tt_t2t,tt_GetDad(tt_t2t),tt_t2tDad),a.position=tt_t2t.t_cp,a.left=tt_t2t.t_cl,a.top=tt_t2t.t_ct,tt_t2tDad=null}function tt_OverInit(){tt_over=window.event?window.event.target||window.event.srcElement:tt_ovr_,tt_DeAlt(tt_over),tt_OpDeHref(tt_over)}function tt_ShowInit(){tt_tShow.Timer("tt_Show()",tt_aV[DELAY],!0),(tt_aV[CLICKCLOSE]||tt_aV[CLICKSTICKY])&&tt_AddEvtFnc(document,"mouseup",tt_OnLClick)}function tt_Show(){var a=tt_aElt[0].style;a.zIndex=Math.max(window.dd&&dd.z?dd.z+2:0,1010),(tt_aV[STICKY]||!tt_aV[FOLLOWMOUSE])&&(tt_iState&=-5),tt_aV[EXCLUSIVE]&&(tt_iState|=8),tt_aV[DURATION]>0&&tt_tDurt.Timer("tt_HideInit()",tt_aV[DURATION],!0),tt_ExtCallFncs(0,"Show"),a.visibility="visible",tt_iState|=2,tt_aV[FADEIN]&&tt_Fade(0,0,tt_aV[OPACITY],Math.round(tt_aV[FADEIN]/tt_aV[FADEINTERVAL])),tt_ShowIfrm()}function tt_ShowIfrm(){if(tt_ie56){var a=tt_aElt[tt_aElt.length-1];if(a){var b=a.style;b.zIndex=tt_aElt[0].style.zIndex-1,b.display="block"}}}function tt_Move(a){if(a&&(tt_ovr_=a.target||a.srcElement),a=a||window.event,a&&(tt_musX=tt_GetEvtX(a),tt_musY=tt_GetEvtY(a)),4&tt_iState){if(!tt_op&&!tt_ie){if(tt_bWait)return;tt_bWait=!0,tt_tWaitMov.Timer("tt_bWait = false;",1,!0)}tt_aV[FIX]?(tt_iState&=-5,tt_PosFix()):tt_ExtCallFncs(a,"MoveBefore")||tt_SetTipPos(tt_Pos(0),tt_Pos(1)),tt_ExtCallFncs([tt_musX,tt_musY],"MoveAfter")}}function tt_Pos(a){var b,c,d,e,f,g,h,i,j;return a?(c=tt_aV[JUMPVERT],d=ABOVE,e=OFFSETY,f=tt_h,g=tt_maxPosY,h=tt_GetScrollY(),i=tt_musY,j=tt_bJmpVert):(c=tt_aV[JUMPHORZ],d=LEFT,e=OFFSETX,f=tt_w,g=tt_maxPosX,h=tt_GetScrollX(),i=tt_musX,j=tt_bJmpHorz),c?b=tt_aV[d]&&(!j||tt_CalcPosAlt(a)>=h+16)?tt_PosAlt(a):!tt_aV[d]&&j&&tt_CalcPosDef(a)>g-16?tt_PosAlt(a):tt_PosDef(a):(b=i,tt_aV[d]?b-=f+tt_aV[e]-(tt_aV[SHADOW]?tt_aV[SHADOWWIDTH]:0):b+=tt_aV[e]),b>g&&(b=c?tt_PosAlt(a):g),h>b&&(b=c?tt_PosDef(a):h),b}function tt_PosDef(a){return a?tt_bJmpVert=tt_aV[ABOVE]:tt_bJmpHorz=tt_aV[LEFT],tt_CalcPosDef(a)}function tt_PosAlt(a){return a?tt_bJmpVert=!tt_aV[ABOVE]:tt_bJmpHorz=!tt_aV[LEFT],tt_CalcPosAlt(a)}function tt_CalcPosDef(a){return a?tt_musY+tt_aV[OFFSETY]:tt_musX+tt_aV[OFFSETX]}function tt_CalcPosAlt(a){var b=a?OFFSETY:OFFSETX,c=tt_aV[b]-(tt_aV[SHADOW]?tt_aV[SHADOWWIDTH]:0);return tt_aV[b]>0&&0>=c&&(c=1),(a?tt_musY-tt_h:tt_musX-tt_w)-c}function tt_PosFix(){var a,b;if("number"==typeof tt_aV[FIX][0])a=tt_aV[FIX][0],b=tt_aV[FIX][1];else for(el="string"==typeof tt_aV[FIX][0]?tt_GetElt(tt_aV[FIX][0]):tt_aV[FIX][0],a=tt_aV[FIX][1],b=tt_aV[FIX][2],!tt_aV[ABOVE]&&el&&(b+=tt_GetDivH(el));el;el=el.offsetParent)a+=el.offsetLeft||0,b+=el.offsetTop||0;tt_aV[ABOVE]&&(b-=tt_h),tt_SetTipPos(a,b)}function tt_Fade(a,b,c,d){d&&(b+=Math.round((c-b)/d),(c>a?b>=c:c>=b)?b=c:tt_tFade.Timer("tt_Fade("+a+","+b+","+c+","+(d-1)+")",tt_aV[FADEINTERVAL],!0)),b?tt_SetTipOpa(b):tt_Hide()}function tt_SetTipOpa(a){tt_SetOpa(tt_aElt[5],a),tt_aElt[1]&&tt_SetOpa(tt_aElt[1],a),tt_aV[SHADOW]&&(a=Math.round(.8*a),tt_SetOpa(tt_aElt[7],a),tt_SetOpa(tt_aElt[8],a))}function tt_OnCloseBtnOver(a){var b=tt_aElt[4].style;a<<=1,b.background=tt_aV[CLOSEBTNCOLORS][a],b.color=tt_aV[CLOSEBTNCOLORS][a+1]}function tt_OnLClick(a){a=a||window.event,a.button&&2&a.button||a.which&&3==a.which||(tt_aV[CLICKSTICKY]&&4&tt_iState?(tt_aV[STICKY]=!0,tt_iState&=-5):tt_aV[CLICKCLOSE]&&tt_HideInit())}function tt_Int(a){var b;return isNaN(b=parseInt(a))?0:b}function tt_GetWndCliSiz(a){var b,c=window["inner"+a],d="client"+a,e="number";if(typeof c==e){var f;return(b=document.body)&&typeof(f=b[d])==e&&f&&c>=f?f:(b=document.documentElement)&&typeof(f=b[d])==e&&f&&c>=f?f:c}return(b=document.documentElement)&&(c=b[d])?c:document.body[d]}function tt_SetOpa(a,b){var c=a.style;if(tt_opa=b,1==tt_flagOpa)if(100>b){typeof a.filtNo==tt_u&&(a.filtNo=c.filter);var d="hidden"!=c.visibility;c.zoom="100%",d||(c.visibility="visible"),c.filter="alpha(opacity="+b+")",d||(c.visibility="hidden")}else typeof a.filtNo!=tt_u&&(c.filter=a.filtNo);else switch(b/=100,tt_flagOpa){case 2:c.KhtmlOpacity=b;break;case 3:c.KHTMLOpacity=b;break;case 4:c.MozOpacity=b;break;case 5:c.opacity=b}}function tt_Err(a,b){(tt_Debug||!b)&&alert("Tooltip Script Error Message:\n\n"+a)}function tt_ExtCmdEnum(){var s;for(var i in config)s="window."+i.toString().toUpperCase(),eval("typeof("+s+") == tt_u")&&(eval(s+" = "+tt_aV.length),tt_aV[tt_aV.length]=null)}function tt_ExtCallFncs(a,b){for(var c=!1,d=tt_aExt.length;d;){--d;var e=tt_aExt[d]["On"+b];e&&e(a)&&(c=!0)}return c}var config=new Object,tt_Debug=!0,tt_Enabled=!0,TagsToTip=!0;config.Above=!1,config.BgColor="#E2E7FF",config.BgImg="",config.BorderColor="#003099",config.BorderStyle="solid",config.BorderWidth=1,config.CenterMouse=!1,config.ClickClose=!1,config.ClickSticky=!1,config.CloseBtn=!1,config.CloseBtnColors=["#990000","#FFFFFF","#DD3333","#FFFFFF"],config.CloseBtnText="&nbsp;X&nbsp;",config.CopyContent=!0,config.Delay=400,config.Duration=0,config.Exclusive=!1,config.FadeIn=100,config.FadeOut=100,config.FadeInterval=30,config.Fix=null,config.FollowMouse=!0,config.FontColor="#000044",config.FontFace="Verdana,Geneva,sans-serif",config.FontSize="8pt",config.FontWeight="normal",config.Height=0,config.JumpHorz=!1,config.JumpVert=!0,config.Left=!1,config.OffsetX=14,config.OffsetY=8,config.Opacity=100,config.Padding=3,config.Shadow=!1,config.ShadowColor="#C0C0C0",config.ShadowWidth=5,config.Sticky=!1,config.TextAlign="left",config.Title="",config.TitleAlign="left",config.TitleBgColor="",config.TitleFontColor="#FFFFFF",config.TitleFontFace="",config.TitleFontSize="",config.TitlePadding=2,config.Width=0;var tt_aElt=new Array(10),tt_aV=new Array,tt_sContent,tt_t2t,tt_t2tDad,tt_musX,tt_musY,tt_over,tt_x,tt_y,tt_w,tt_h,tt_aExt=new Array,tt_db,tt_op,tt_ie,tt_ie56,tt_bBoxOld,tt_body,tt_ovr_,tt_flagOpa,tt_maxPosX,tt_maxPosY,tt_iState=0,tt_opa,tt_bJmpVert,tt_bJmpHorz,tt_elDeHref,tt_tShow=new Number(0),tt_tHide=new Number(0),tt_tDurt=new Number(0),tt_tFade=new Number(0),tt_tWaitMov=new Number(0),tt_bWait=!1,tt_u="undefined";Number.prototype.Timer=function(a,b,c){(!this.value||c)&&(this.value=window.setTimeout(a,b))},Number.prototype.EndTimer=function(){this.value&&(window.clearTimeout(this.value),this.value=0)},tt_Init()};Smits={},Smits.Common={nodeIdIncrement:0,activeNode:0,roundFloat:function(a,b){for(var c=0,d=1;b>c;)d*=10,c++;return Math.round(a*d)/d},apply:function(a,b){if(a&&"object"==typeof b)for(var c in b)a[c]=b[c];return a},addRaphEventHandler:function(a,b,c,d){try{a[b](function(a,b){return function(c){var d=b;d.e=c,a(d)}}(c,d))}catch(e){}},isInteger:function(a){return!isNaN(parseInt(a))},isXMLSerializerAvailable:function(){return"function"==typeof XMLSerializer?!0:!1},createSvgEl:function(a,b){if(a=document.createElementNS("http://www.w3.org/2000/svg",a),b)for(var c in b)b.hasOwnProperty(c)&&a.setAttribute(c,String(b[c]));return a},createGradientEl:function(a,b,c){if("radialGradient"!=b.type)return!1;var d=Smits.Common.createSvgEl("radialGradient",{id:a,gradientUnits:"userSpaceOnUse",cx:c[0],cy:c[1],r:c[2],fx:c[0],fy:c[1]});if(b.stop)for(var e=b.stop,f=0;f<e.length;f++){var g=e[f];g["@attributes"]?d.appendChild(Smits.Common.createSvgEl("stop",g["@attributes"])):(g._attributes&&delete g._attributes,g._children&&delete g._children,g.__proto__&&delete g.__proto__,d.appendChild(Smits.Common.createSvgEl("stop",g)))}return d},setCssStyle:function(a,b){var c=document.styleSheets[0];c.addRule?c.addRule(a,b):c.insertRule&&c.insertRule(a+" { "+b+" }",c.cssRules.length)}},Smits.PhyloCanvas=function(){var a,b,c,d,e;return function(f,g,h,i,j){if(this.getNewickObject=function(){return c},this.clear=function(){},this.scale=function(a){d.svg.scale(a)},this.getSvg=function(){return d},this.getPhylogram=function(){return a},this.getSvgSource=function(){if(Raphael.svg&&Smits.Common.isXMLSerializerAvailable()){var a=new XMLSerializer;return a.serializeToString(d.svg.canvas)}return!1},"object"==typeof f)if(f.xml){if(f.fileSource)var k=f.xml;else var k=XMLObjectifier.textToXML(f.xml);k=XMLObjectifier.xmlToJSON(k),e=new Smits.PhyloCanvas.PhyloxmlParse(k)}else if(f.phyloxml){if(f.fileSource)var k=f.phyloxml;else var k=XMLObjectifier.textToXML(f.phyloxml);k=XMLObjectifier.xmlToJSON(k),e=new Smits.PhyloCanvas.PhyloxmlParse(k)}else if(f.nexml){if(f.fileSource)var k=f.nexml;else var k=XMLObjectifier.textToXML(f.nexml);k=XMLObjectifier.xmlToJSON(k),e=new Smits.PhyloCanvas.NexmlParse(k,f)}else f.json?e=new Smits.PhyloCanvas.PhyloxmlParse(f.json):f.newick?e=new Smits.PhyloCanvas.NewickParse(f.newick):f.nexmlJson?e=new Smits.PhyloCanvas.NexmlJsonParse(f):alert("Please set the format of input data");else e=new Smits.PhyloCanvas.NewickParse(f);b=g,d=new Smits.PhyloCanvas.Render.SVG(b,h,i),a="circular"==j?new Smits.PhyloCanvas.Render.CircularPhylogram(d,e):new Smits.PhyloCanvas.Render.Phylogram(d,e)}}(),Smits.PhyloCanvas.prototype={},Smits.PhyloCanvas.Node=function(){return function(a,b){this.id=Smits.Common.nodeIdIncrement+=1,this.level=0,this.len=0,this.newickLen=0,this.name="",this.type="",this.chart={},this.img=[],a&&Smits.Common.apply(this,a),this._countAllChildren=!1,this._countImmediateChildren=!1,this._midBranchPosition=!1,this.children=new Array,b&&b.children.push(this)}}(),Smits.PhyloCanvas.Node.prototype={getCountAllChildren:function(){if(this._countAllChildren!==!1)return this._countAllChildren;var a=0;for(var b in this.children)if(Smits.Common.isInteger(b)){var c=this.children[b];c.children&&c.children.length>0?a+=c.getCountAllChildren():a++}return this._countAllChildren=a,a},getCountImmediateChildren:function(){if(this._countImmediateChildren!==!1)return this._countImmediateChildren;var a=0;for(var b in this.children){var c=this.children[b];a+=c.length}return this._countImmediateChildren=a,a},getMidbranchPosition:function(a){if(this._midBranchPosition!==!1)return this._midBranchPosition;for(var b=[0,0],c=0;c<this.children.length;c++){var d=this.children[c];d.children&&d.children.length>0?0==c&&a?(b[0]=d.getMidbranchPosition(!0),b[1]+=d.getCountAllChildren()-1):0==c?(b[0]=d.getMidbranchPosition(),b[1]+=d.getCountAllChildren()):b[1]+=c==this.children.length-1?d.getMidbranchPosition():d.getCountAllChildren():0==c&&a?b[0]=0:0==c?(b[0]=1,b[1]+=1):b[1]+=c==this.children.length-1?1:1}return this._midBranchPosition=b[1]>=b[0]?(b[1]+b[0])/2:b[0],this._midBranchPosition}},Smits.PhyloCanvas.NewickParse=function(){var a,b,c,d,e,f=0,g=0,h=function(a){for(var c=new Smits.PhyloCanvas.Node;")"!==b&&","!==b;)":"===b?(l(),c.len=Smits.Common.roundFloat(j(),4),0==c.len&&(c.len=1e-4)):"'"===b||'"'===b?(c.type="label",c.name=k(b)):(c.type="label",c.name=j());return c.level=a.level+1,c},i=function(a){var c=new Smits.PhyloCanvas.Node;for(a&&(c.level=a.level+1);")"!==b;)l(),"("===b?c.children.push(i(c)):c.children.push(h(c));return l(),":"!==b&&")"!==b&&","!==b&&";"!==b&&(c.type="label",c.name=j()),":"===b&&(l(),c.len=Smits.Common.roundFloat(j(),4),0==c.len&&(c.len=1e-4),c.type="stem"),c},j=function(){for(var a="";":"!==b&&")"!==b&&","!==b&&";"!==b;)a+=b,l();return a},k=function(a){for(var c="";b!==a;)c+=b,l();return c},l=function(){return b=a.charAt(c),c+=1,b},m=function(a){if(a.children&&a.children.length)for(var b=0;b<a.children.length;b++){var c=a.children[b];0===c.len&&(c.len=1),c.newickLen=Smits.Common.roundFloat(c.len+a.newickLen,4),c.level>f&&(f=c.level),c.newickLen>g&&(g=c.newickLen),c.children.length>0&&m(c,a)}return a};return function(b){this.getRoot=function(){return d},this.getLevels=function(){return f},this.getNewickLen=function(){return g},this.getValidate=function(){return e},f=0,g=0,a=b,c=0,l(),d=i(),d=m(d)}}(),Smits.PhyloCanvas.NewickParse.prototype={},Smits.PhyloCanvas.PhyloxmlParse=function(){var a,b,c=0,d=0,e=function(a,c){var d=new Smits.PhyloCanvas.Node;if(c&&(d.level=c.level+1),a.clade&&a.clade.length)for(var f=0;f<a.clade.length;f++){var g=a.clade[f];d.children.push(e(g,d))}if(a.branch_length&&("object"==typeof a.branch_length&&(a.branch_length=a.branch_length[0].Text),d.len=Smits.Common.roundFloat(a.branch_length,4),0==d.len&&(d.len=1e-4)),a.name?(d.type="label",d.name=a.name[0].Text,a.name[0]&&a.name[0].style&&(d.style=a.name[0].style),a.name[0]&&a.name[0].bgStyle&&(d.bgStyle=a.name[0].bgStyle)):a.confidence&&(d.name=a.confidence[0].Text),a.sequence&&a.sequence[0]&&a.sequence[0].name&&a.sequence[0].name[0]&&a.sequence[0].name[0].Text&&(d.sequenceName=a.sequence[0].name[0].Text),a.taxonomy&&a.taxonomy[0]&&(a.taxonomy[0].scientific_name&&a.taxonomy[0].scientific_name[0]&&a.taxonomy[0].scientific_name[0].Text&&(d.taxonomyScientificName=a.taxonomy[0].scientific_name[0].Text),a.taxonomy[0].common_name&&a.taxonomy[0].common_name[0]&&a.taxonomy[0].common_name[0].Text&&(d.taxonomyCommonName=a.taxonomy[0].common_name[0].Text)),a.sequence&&a.sequence[0]&&a.sequence[0].accession&&a.sequence[0].accession[0]&&a.sequence[0].accession[0].Text&&(d.sequenceAccession=a.sequence[0].accession[0].Text),a.point&&(d.LatLong=[a.point[0].lat[0].Text,a.point[0]["long"][0].Text]),d.name||(d.sequenceName?d.name=d.sequenceName:d.taxonomyScientificName?d.name=d.taxonomyScientificName:d.taxonomyCommonName?d.name=d.taxonomyCommonName:d.sequenceAccession&&(d.name=d.sequenceAccession),d.name&&(d.type="label")),a.annotation&&(a.annotation[0]&&a.annotation[0].desc&&a.annotation[0].desc[0]&&a.annotation[0].desc[0].Text&&(d.description=a.annotation[0].desc[0].Text),a.annotation[0]&&a.annotation[0].uri&&a.annotation[0].uri[0]&&a.annotation[0].uri[0].Text&&(d.uri=a.annotation[0].uri[0].Text),a.annotation[0]&&a.annotation[0].img))for(var f in a.annotation[0].img)Smits.Common.isInteger(f)&&(d.img[f]=a.annotation[0].img[f].Text);if(a.chart&&a.chart[0])for(var f in a.chart[0])"Text"!=f&&"_children"!=f&&(d.chart[f]=a.chart[0][f][0].Text);return d&&d.level>1&&(d.len||(b="Error. Please include Branch Lengths - we only draw rooted phylogenetic trees.")),d},f=function(a){if(a.children&&a.children.length)for(var b=0;b<a.children.length;b++){var e=a.children[b];e.newickLen=Math.round(1e4*(e.len+a.newickLen))/1e4,e.level>c&&(c=e.level),e.newickLen>d&&(d=e.newickLen),e.children.length>0&&f(e,a)}return a},g=function(a,b){for(var c in a)"_children"!=c&&"Text"!=c&&("rectangular"==c||"circular"==c?g(a[c][0],c):(Smits.PhyloCanvas.Render.Parameters[c]||(Smits.PhyloCanvas.Render.Parameters[c]={}),Smits.PhyloCanvas.Render.Parameters.set(c,a[c][0].Text,b)))
};return function(h){if(this.getRoot=function(){return a},this.getLevels=function(){return c},this.getNewickLen=function(){return d},this.getValidate=function(){return b},h.phylogeny&&h.phylogeny[0]&&h.phylogeny[0].clade&&(a=e(h.phylogeny[0].clade[0])),h.phylogeny&&h.phylogeny[0]&&h.phylogeny[0].render&&h.phylogeny[0].render[0]){var i=h.phylogeny[0].render[0];if(i&&i.styles){var j=i.styles[0];for(var k in j)if("_children"!=k&&"Text"!=k)if(j[k][0].type&&"radialGradient"==j[k][0].type&&Raphael.svg)j[k][0].name=k,Smits.PhyloCanvas.Render.Style[k]=j[k][0],Smits.PhyloCanvas.Render.Style.jsphylosvgGradientList||(Smits.PhyloCanvas.Render.Style.jsphylosvgGradientList=[]),Smits.PhyloCanvas.Render.Style.jsphylosvgGradientList.push(k);else{Smits.PhyloCanvas.Render.Style[k]||(Smits.PhyloCanvas.Render.Style[k]={});for(var l in j[k][0])"_attributes"!=l&&"_children"!=l&&"type"!=l&&(Smits.PhyloCanvas.Render.Style[k][l.replace("_","-")]=j[k][0][l])}}if(i&&i.parameters&&g(i.parameters[0]),i&&i.charts){var m=i.charts[0];for(var k in m)if("_children"!=k&&"Text"!=k)for(var l in m[k])"binary"==m[k][l].type?(m[k][l].chart=k,Smits.PhyloCanvas.Render.Parameters.binaryCharts.push(m[k][l])):"integratedBinary"==m[k][l].type?(m[k][l].chart=k,Smits.PhyloCanvas.Render.Parameters.integratedBinaryCharts.push(m[k][l])):"bar"==m[k][l].type&&(m[k][l].chart=k,Smits.PhyloCanvas.Render.Parameters.barCharts.push(m[k][l]))}}a=f(a)}}(),Smits.PhyloCanvas.PhyloxmlParse.prototype={},Smits.PhyloCanvas.NexmlParse=function(){var a,b,c,d,e=0,f=0,g=function(a,b,e){var f=new Smits.PhyloCanvas.Node;e&&(f.level=e.level+1);for(var h=0;h<c.length;h++)if(c[h].source==a.id)for(var i=0;i<d.length;i++)c[h].target==d[i].id&&f.children.push(g(d[i],c[h].length,f));return f&&f.level>0&&!f.len&&(f.len=1),b&&(f.len=Smits.Common.roundFloat(b,4),0==f.len&&(f.len=1e-4)),a.label&&(f.type="label",f.name=a.label,a.style&&(f.style=a.style)),f},h=function(a){if(a.children&&a.children.length)for(var b=0;b<a.children.length;b++){var c=a.children[b];c.newickLen=Math.round(1e4*(c.len+a.newickLen))/1e4,c.level>e&&(e=c.level),c.newickLen>f&&(f=c.newickLen),c.children.length>0&&h(c,a)}return a};return function(i,j){this.getRoot=function(){return a},this.getLevels=function(){return e},this.getNewickLen=function(){return f},this.getValidate=function(){return b},j.tree&&i.trees[0]&&i.trees[0].tree[j.tree-1]?(c=i.trees[0].tree[j.tree-1].edge,d=i.trees[0].tree[j.tree-1].node):(c=i.trees[0].tree[0].edge,d=i.trees[0].tree[0].node);for(var k=0;k<d.length;k++){var l=0;if(d[k].root&&"true"==d[k].root){a=d[k];break}for(var m=0;m<c.length;m++)c[m].target==d[k].id&&l++;if(0==l){a=d[k];break}}a?(a=g(a),a=h(a)):b="Error. Currently, only rooted NeXML trees are supported."}}(),Smits.PhyloCanvas.NexmlParse.prototype={},Smits.PhyloCanvas.NexmlJsonParse=function(){var a,b,c=0,d=0,e=[],f=[],g=function(a,c,d){var h=new Smits.PhyloCanvas.Node;d&&(h.level=d.level+1);for(var i=0;i<e.length;i++)if(e[i].source==a.id)for(var j=0;j<f.length;j++)e[i].target==f[j].id&&h.children.push(g(f[j],e[i].length,h));return c&&(h.len=Smits.Common.roundFloat(c,4),0==h.len&&(h.len=1e-4)),a.label&&(h.type="label",h.name=a.label,a.accession&&(h.accession=a.accession),a.style&&(h.style=a.style),a.bgStyle&&(h.bgStyle=a.bgStyle)),a.chart&&(h.chart=a.chart),h&&h.level>1&&(h.len||(b="Error. Please include Branch Lengths - we only draw rooted phylogenetic trees.")),h},h=function(a){if(a.children&&a.children.length)for(var b=0;b<a.children.length;b++){var e=a.children[b];e.newickLen=Math.round(1e4*(e.len+a.newickLen))/1e4,e.level>c&&(c=e.level),e.newickLen>d&&(d=e.newickLen),e.children.length>0&&h(e,a)}return a},i=function(a,b){for(var c in a)"_children"!=c&&"Text"!=c&&("rectangular"==c||"circular"==c?i(a[c],c):(Smits.PhyloCanvas.Render.Parameters[c]||(Smits.PhyloCanvas.Render.Parameters[c]={}),Smits.PhyloCanvas.Render.Parameters.set(c,a[c],b)))};return function(j){this.getRoot=function(){return a},this.getLevels=function(){return c},this.getNewickLen=function(){return d},this.getValidate=function(){return b};var k=j.nexmlJson.nexml,l=k.render;if(l&&l.styles){var m=l.styles;for(var n in m)if("_children"!=n&&"Text"!=n)if(m[n]["@attributes"].type&&"radialGradient"==m[n]["@attributes"].type&&Raphael.svg)m[n].name=n,m[n].type=m[n]["@attributes"].type,Smits.PhyloCanvas.Render.Style[n]=m[n],Smits.PhyloCanvas.Render.Style.jsphylosvgGradientList||(Smits.PhyloCanvas.Render.Style.jsphylosvgGradientList=[]),Smits.PhyloCanvas.Render.Style.jsphylosvgGradientList.push(n);else{Smits.PhyloCanvas.Render.Style[n]||(Smits.PhyloCanvas.Render.Style[n]={});for(var o in m[n]["@attributes"])"_attributes"!=o&&"_children"!=o&&"type"!=o&&(Smits.PhyloCanvas.Render.Style[n][o.replace("_","-")]=m[n]["@attributes"][o])}}if(l&&l.parameters&&i(l.parameters),l&&l.charts){var p=l.charts;for(var n in p)p[n]["@attributes"].chart=n,"binary"==p[n]["@attributes"].type?Smits.PhyloCanvas.Render.Parameters.binaryCharts.push(p[n]["@attributes"]):"integratedBinary"==p[n]["@attributes"].type?Smits.PhyloCanvas.Render.Parameters.integratedBinaryCharts.push(p[n]["@attributes"]):"bar"==p[n]["@attributes"].type&&Smits.PhyloCanvas.Render.Parameters.barCharts.push(p[n]["@attributes"])}if(j.tree&&k.trees[0]&&k.trees[0].tree[j.tree-1])e=k.trees[0].tree[j.tree-1].edge,f=k.trees[0].tree[j.tree-1].node;else{for(var n=0;n<k.trees.tree.edge.length;n++)e.push(k.trees.tree.edge[n]["@attributes"]);for(var n=0;n<k.trees.tree.node.length;n++){var q=k.trees.tree.node[n]["@attributes"];q.label&&(q.chart=k.trees.tree.node[n].chart),f.push(q)}}for(var n=0;n<f.length;n++)f[n].root&&"true"==f[n].root&&(a=f[n]);a?(a=g(a),a=h(a)):b="Error. Currently, only rooted NeXML trees are supported."}}(),Smits.PhyloCanvas.NexmlParse.prototype={},Smits.PhyloCanvas.Render={},Smits.PhyloCanvas.Render.Style={line:{stroke:"rgb(0,0,0)","stroke-width":1},text:{"font-family":"Verdana","font-size":12,"text-anchor":"start"},path:{stroke:"rgb(0,0,0)","stroke-width":1},connectedDash:{stroke:"rgb(200,200,200)","stroke-dasharray":". "},textSecantBg:{fill:"#EEE",stroke:"#DDD"},highlightedEdgeCircle:{fill:"red"},barChart:{fill:"#003300",stroke:"#DDD"},getStyle:function(a,b){return this[a]?this[a]:this[b]}},Smits.PhyloCanvas.Render.Parameters={jsOverride:0,Rectangular:{bufferX:200,paddingX:10,paddingY:20,bufferInnerLabels:10,bufferOuterLabels:5,minHeightBetweenLeaves:10,alignPadding:0,alignRight:!1,showScaleBar:!1},Circular:{bufferRadius:.33,bufferAngle:20,initStartAngle:160,innerCircleRadius:0,minHeightBetweenLeaves:5,bufferInnerLabels:2,bufferOuterLabels:5},binaryCharts:[],integratedBinaryCharts:[],barCharts:[],binaryChartBufferInner:5,binaryChartBufferSiblings:.01,binaryChartThickness:15,binaryChartDisjointed:!1,barChartBufferInner:3,barChartHeight:50,barChartWidth:.5,mouseRollOver:function(a){if(a.node.edgeCircleHighlight)a.node.edgeCircleHighlight.show();else{var b=a.svg.draw(new Smits.PhyloCanvas.Render.Circle(a.x,a.y,5,{attr:Smits.PhyloCanvas.Render.Style.highlightedEdgeCircle}));a.node.edgeCircleHighlight=b[0]}a.textEl.attr({fill:"red"})},mouseRollOut:function(a){a.node.edgeCircleHighlight.hide(),a.textEl.attr({fill:"#000"})},set:function(a,b,c){this.jsOverride||(c?"circular"==c?this.Circular[a]=parseFloat(b):"rectangular"==c&&(this.Rectangular[a]=parseFloat(b)):this[a]=parseFloat(b))}},Smits.PhyloCanvas.Render.Line=function(){return function(a,b,c,d,e){this.type="line",this.attr=Smits.PhyloCanvas.Render.Style.line,this.x1=a,this.x2=b,this.y1=c,this.y2=d,e&&(Smits.Common.apply(this,e),e.attr&&(this.attr=e.attr))}}(),Smits.PhyloCanvas.Render.Text=function(){return function(a,b,c,d){this.type="text",this.attr=Smits.PhyloCanvas.Render.Style.text,this.x=a,this.y=b,this.text=c,d&&(Smits.Common.apply(this,d),d.attr&&(this.attr=d.attr))}}(),Smits.PhyloCanvas.Render.Path=function(){return Smits.PhyloCanvas.Render.Style.path,function(a,b){this.type="path",this.attr=Smits.PhyloCanvas.Render.Style.path,this.path=a,b&&(Smits.Common.apply(this,b),b.attr&&(this.attr=b.attr))}}(),Smits.PhyloCanvas.Render.Circle=function(){return function(a,b,c,d){this.type="circle",this.x=a,this.y=b,this.radius=c,d&&(Smits.Common.apply(this,d),d.attr&&(this.attr=d.attr))}}(),Smits.PhyloCanvas.Render.SVG=function(){var a;return function(b,c,d){a=b,this.canvasSize=[c,d],this.svg=Raphael(b,this.canvasSize[0],this.canvasSize[1])}}(),Smits.PhyloCanvas.Render.SVG.prototype={render:function(){var a=this.phylogramObject.getDrawInstructs();console.log("render",this.phylogramObject.getDrawInstructs());for(var b=0;b<a.length;b++)if("line"==a[b].type)this.svg.path(["M",a[b].x1,a[b].y1,"L",a[b].x2,a[b].y2]).attr(Smits.PhyloCanvas.Render.Style.line);else if("path"==a[b].type)this.svg.path(a[b].path).attr(a[b].attr);else if("circle"==a[b].type)this.svg.circle(a[b].x,a[b].y,a[b].radius).attr({stroke:"red"});else{var c=this.svg.text(a[b].x,a[b].y,a[b].text).attr(Smits.PhyloCanvas.Render.Style.text);a[b].attr&&c.attr(a[b].attr),a[b].rotate&&c.rotate(a[b].rotate);var d=c.getBBox();Math.sqrt(d.height*d.height+d.width*d.width)}},draw:function(a){var b,c;if("line"==a.type)b=this.svg.path(["M",a.x1,a.y1,"L",a.x2,a.y2]).attr(Smits.PhyloCanvas.Render.Style.line);else if("path"==a.type)b=this.svg.path(a.path).attr(a.attr);else if("circle"==a.type)b=this.svg.circle(a.x,a.y,a.radius).attr({stroke:"red"});else if("text"==a.type){b=this.svg.text(a.x,a.y,a.text).attr(Smits.PhyloCanvas.Render.Style.text),a.attr&&b.attr(a.attr),a.rotate&&b.rotate(a.rotate);var d=b.getBBox();c=Math.sqrt(d.height*d.height+d.width*d.width)}return[b,c]}},Smits.PhyloCanvas.Render.Phylogram=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o=Smits.PhyloCanvas.Render.Parameters.Rectangular,p=!0,q=0,r=0,s=[],t=function(a,b,c,d){return["M",a,b,"L",c,b,"L",c,d,"L",a,d,"Z"]},u=function(b,c){if(b.len&&0==p&&0==b.children.length&&(q=Smits.Common.roundFloat(q+e,4)),b.children.length>0){var g,h,i,j,k=[];if(b.len&&(g=c,h=c=Smits.Common.roundFloat(c+d*b.len,4),i=q+b.getMidbranchPosition(p)*e,j=i,a.draw(new Smits.PhyloCanvas.Render.Line(g,h,i,j))),b.name){var l={};if(l=Smits.PhyloCanvas.Render.Style.getStyle("bootstrap","text"),b.uri&&(l.href=b.uri,l.target="_blank"),b.description&&(l.title=b.description),0==b.level)var m=q+b.getMidbranchPosition(p)*e;else var m=j;a.draw(new Smits.PhyloCanvas.Render.Text((h||c)+5,m,b.name,{attr:l}))}if(b.children&&b.children.length)for(var n=0;n<b.children.length;n++){var t=b.children[n];k.push(u(t,c))}for(var v=[],n=0;n<k.length;n++)k[n][0]&&v.push(k[n][0]),k[n][1]&&v.push(k[n][1]);var w=Math.min.apply(null,v),x=Math.max.apply(null,v);a.draw(new Smits.PhyloCanvas.Render.Path(["M",c+1e-4,w,"L",c,w,"L",c,x,"L",c+1e-4,x],{attr:Smits.PhyloCanvas.Render.Style.line}))}else{if(g=c,h=Smits.Common.roundFloat(c+d*b.len,2),i=q,j=q,b.y=q,s.push(b),a.draw(new Smits.PhyloCanvas.Render.Line(g,h,i,j)),o.alignRight&&a.draw(new Smits.PhyloCanvas.Render.Path(["M",h,i,"L",o.alignPadding+f,j],{attr:Smits.PhyloCanvas.Render.Style.connectedDash})),b.name){var l={};b.style&&(l=Smits.PhyloCanvas.Render.Style.getStyle(b.style,"text")),l["text-anchor"]="start",b.uri&&(l.href=b.uri,l.target="_blank"),b.description&&(l.title=b.description);var y=a.draw(new Smits.PhyloCanvas.Render.Text(o.alignRight?f+o.bufferInnerLabels+o.alignPadding:h+o.bufferInnerLabels,j,b.name,{attr:l}));r=Math.max(y[1],r),Smits.PhyloCanvas.Render.Parameters.mouseRollOver&&Smits.Common.addRaphEventHandler(y[0],"mouseover",Smits.PhyloCanvas.Render.Parameters.mouseRollOver,{svg:a,node:b,x:h,y:j,textEl:y[0]}),Smits.PhyloCanvas.Render.Parameters.mouseRollOut&&Smits.Common.addRaphEventHandler(y[0],"mouseout",Smits.PhyloCanvas.Render.Parameters.mouseRollOut,{svg:a,node:b,x:h,y:j,textEl:y[0]}),Smits.PhyloCanvas.Render.Parameters.onClickAction&&Smits.Common.addRaphEventHandler(y[0],"click",Smits.PhyloCanvas.Render.Parameters.onClickAction,{svg:a,node:b,x:h,y:j,textEl:y[0]})}p&&(p=!1)}return[i,j]},v=function(){y=q+e,j=0,k=o.showScaleBar*d,a.draw(new Smits.PhyloCanvas.Render.Line(j,k,y,y)),a.draw(new Smits.PhyloCanvas.Render.Text((j+k)/2,y-8,o.showScaleBar))},w=function(b,c,d){for(var f=(d&&d.bufferInner?d.bufferInner:0)|Smits.PhyloCanvas.Render.Parameters.binaryChartBufferInner,g=(d&&d.bufferSiblings?d.bufferSiblings*e:0)|(Smits.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings<1?e*Smits.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings:Smits.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings),h=(d&&d.thickness?d.thickness:0)|Smits.PhyloCanvas.Render.Parameters.binaryChartThickness,i=0;i<s.length;i++){var j=s[i];a.draw(new Smits.PhyloCanvas.Render.Path(t(b+f,j.y-e/2+g/2,b+f+h,j.y+e/2-g/2),{attr:Smits.PhyloCanvas.Render.Style.getStyle(j.chart[c],"textSecantBg")}))}return b+f+h},x=function(b,c,d){for(var f,g=[],h=d&&d.bufferInner?d.bufferInner:0|Smits.PhyloCanvas.Render.Parameters.barChartBufferInner,i=d&&d.height?d.height:0|Smits.PhyloCanvas.Render.Parameters.barChartHeight,j=d&&d.width?d.width<1?e*d.width:d.width:0|(Smits.PhyloCanvas.Render.Parameters.barChartWidth<1?e*Smits.PhyloCanvas.Render.Parameters.barChartWidth:Smits.PhyloCanvas.Render.Parameters.barChartWidth),k=0,l=0;l<s.length;l++)g.push(s[l].chart[c]);f=Math.max.apply(null,g),k=Smits.Common.roundFloat(i/f,4);for(var l=0;l<s.length;l++){var m=s[l];a.draw(new Smits.PhyloCanvas.Render.Path(t(b+h,m.y-j/2,b+h+k*m.chart[c],m.y+j/2),{attr:Smits.PhyloCanvas.Render.Style.getStyle(m.chart[c],"barChart")}))}return b+h+i};return function(j,k){this.getCanvasSize=function(){return[b,c]},this.getRoot=function(){return k.getRoot()},k.getValidate()&&a.draw(0,0,k.getValidate()),a=j;var p=k.getRoot(),s=k.getNewickLen();if(b=a.canvasSize[0],c=a.canvasSize[1],l=o.bufferX,m=o.paddingX,n=o.paddingY,g=o.minHeightBetweenLeaves,q=n,d=Math.round((b-l-2*m)/s),e=Math.round((c-2*n)/(o.showScaleBar?p.getCountAllChildren():p.getCountAllChildren()-1)),g>e&&(e=g),f=Math.round(b-l-2*m),(Smits.PhyloCanvas.Render.Parameters.binaryCharts.length||Smits.PhyloCanvas.Render.Parameters.barCharts.length)&&(o.alignRight=!0),u(p,m),o.showScaleBar&&v(),h=f+r+o.bufferInnerLabels,Smits.PhyloCanvas.Render.Parameters.binaryCharts.length){var t=Smits.PhyloCanvas.Render.Parameters.binaryCharts;for(var y in t)h=w(h,t[y].chart,t[y])}if(Smits.PhyloCanvas.Render.Parameters.barCharts.length){var z=Smits.PhyloCanvas.Render.Parameters.barCharts;for(var y in z)i=x(h,z[y].chart,z[y])}}}(),Smits.PhyloCanvas.Render.Phylogram.prototype={},Smits.PhyloCanvas.Render.CircularPhylogram=function(){function a(a,b){return b+=y,[Smits.Common.roundFloat(t+a*Math.sin(b*F),4),Smits.Common.roundFloat(u+a*Math.cos(b*F),4)]}function b(a){var b=e(90-a-y);if(b>90&&270>b){b+=180;var c="end"}else var c="start";return[b,c]}function c(b,c,d,f){var g,h=a(b,c),i=a(b,d),j=[],k=0;return g=Math.abs(e(d-c))>180?1:-1,f&&f.invertSecant&&(g*=-1,k=1),f&&f.noMove||j.push("M"),j.push(h[0],h[1],"A",b,b,0,1>g?0:1,k,i[0],i[1]),j}function d(b,c,d,e){var f=[],g=a(c,b),h=a(d,b);return e&&e.noMove||f.push("M"),f.push(g[0],g[1],"L",h[0],h[1]),f}function e(a){for(;a>360||0>a;)a>360?a-=360:0>a&&(a+=360);return a}function f(a,b,d,e){if(!b&&a.length>1)var e=a[3],d=a[2],b=a[1],a=a[0];var f=h("M",c(a,d,e,{noMove:1,invertSecant:0}),"L",c(b,e,d,{noMove:1,invertSecant:1}),"Z");return f}function g(e,f){if(f=f,e.len&&(A?B=w||1:0==e.children.length&&(B=Smits.Common.roundFloat(B+q,4))),e.children.length>0){var i,j,k,m=[];if(i=f,j=f+=Smits.Common.roundFloat(p*e.len,4),e.name,e.children&&e.children.length)for(var n=0;n<e.children.length;n++){var o=e.children[n],r=g(o,f);r>0&&m.push(r)}var s=Smits.Common.roundFloat(Math.min.apply(null,m),4),t=Smits.Common.roundFloat(Math.max.apply(null,m),4);0!=e.level&&l.draw(new Smits.PhyloCanvas.Render.Path(h("M",a(f+.01,s),"L",c(f,s,t,{noMove:!0}),"L",a(f+.01,t)))),e.len&&(k=Smits.Common.roundFloat(s+(t-s)/2,4),l.draw(new Smits.PhyloCanvas.Render.Path(d(k,i,j))))}else if(e.y=B,C.push(e),i=f,j=f=Smits.Common.roundFloat(f+p*e.len),k=B,l.draw(new Smits.PhyloCanvas.Render.Path(d(k,i,j))),l.draw(new Smits.PhyloCanvas.Render.Path(d(k,j,v),{attr:Smits.PhyloCanvas.Render.Style.connectedDash})),e.name){var u=a(v+z.bufferInnerLabels,k),x=b(k),y=x[0],F=x[1],G={};e.style&&Smits.Common.apply(G,Smits.PhyloCanvas.Render.Style.getStyle(e.style,"text")),G["text-anchor"]=F,e.uri&&(G.href=e.uri,G.target="_blank"),e.description&&(G.title=e.description);var H=l.draw(new Smits.PhyloCanvas.Render.Text(u[0],u[1],e.name,{attr:G,rotate:[y,u[0],u[1]]}));e.bgStyle&&D.push([e.bgStyle,k]);var u=a(j,k);Smits.PhyloCanvas.Render.Parameters.mouseRollOver&&Smits.Common.addRaphEventHandler(H[0],"mouseover",Smits.PhyloCanvas.Render.Parameters.mouseRollOver,{svg:l,node:e,x:u[0],y:u[1],textEl:H[0]}),Smits.PhyloCanvas.Render.Parameters.mouseRollOut&&Smits.Common.addRaphEventHandler(H[0],"mouseout",Smits.PhyloCanvas.Render.Parameters.mouseRollOut,{svg:l,node:e,x:u[0],y:u[1],textEl:H[0]}),Smits.PhyloCanvas.Render.Parameters.onClickAction&&Smits.Common.addRaphEventHandler(H[0],"click",Smits.PhyloCanvas.Render.Parameters.onClickAction,{svg:l,node:e,x:u[0],y:u[1],textEl:H[0]}),E=Math.max(H[1],E)}return A&&(A=!1),k}function h(a){for(var b=a,c=1;c<arguments.length;c++)b=b.concat(arguments[c]);return b}function i(){var a=[];if(D.length>0){if(Smits.PhyloCanvas.Render.Style.jsphylosvgGradientList)for(var b=0;b<Smits.PhyloCanvas.Render.Style.jsphylosvgGradientList.length;b++){var c=Smits.PhyloCanvas.Render.Style.jsphylosvgGradientList[b],d=Smits.Common.createGradientEl(c,Smits.PhyloCanvas.Render.Style[c],[t,u,v+E+z.bufferOuterLabels]);l.svg.defs.appendChild(d)}for(var b=0;b<D.length;b++)if(b==D.length-1||D[b][0]!=D[b+1][0]){var a=f(v,v+E+z.bufferOuterLabels,D[b][2]?D[b][2]-q/2:D[b][1]-q/2,D[b][1]+q/2),e=Smits.PhyloCanvas.Render.Style.getStyle(D[b][0],"textSecantBg"),g=l.draw(new Smits.PhyloCanvas.Render.Path(a,{attr:e.type?{}:e}));e.type&&"radialGradient"==e.type&&g[0].node.setAttribute("fill","url(#"+e.name+")"),e.type&&"radialGradient"==e.type&&g[0].node.setAttribute("stroke","none"),g[0].toBack()}else D[b+1][2]=D[b][2]?D[b][2]:D[b][1]}var a=f(v,v+E+z.bufferOuterLabels,(w||1)-q/2,360-q/2),g=l.draw(new Smits.PhyloCanvas.Render.Path(a,{attr:Smits.PhyloCanvas.Render.Style.textSecantBg}));return g[0].toBack(),v+E+z.bufferOuterLabels}function j(c,d,g){for(var h,i=g&&g.bufferInner?parseFloat(g.bufferInner):Smits.PhyloCanvas.Render.Parameters.binaryChartBufferInner,j=(g&&g.bufferSiblings?g.bufferSiblings*q:0)|(Smits.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings<1?q*Smits.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings:Smits.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings),k=g&&g.thickness?parseFloat(g.thickness):Smits.PhyloCanvas.Render.Parameters.binaryChartThickness,m=(g&&g.disjointed?g.disjointed:!1)|Smits.PhyloCanvas.Render.Parameters.binaryChartDisjointed,n=g&&g.isInternal?g.isInternal:!1,o=!0,p=0;p<C.length;p++){var r=C[p];if(C[p+1]&&r.chart[d]===C[p+1].chart[d]&&!m||"none"==r.chart[d])h||(h=r.y),"none"==r.chart[d]&&(h=0);else{var s=Smits.PhyloCanvas.Render.Style.getStyle(r.chart[d],"textSecantBg");if(n)var t=[v-i-k,v-i,(h?h:r.y)-q/2+(o&&!m?0:j/2),r.y+q/2-(p!=C.length-1||m?j/2:0)];else var t=[c+i,c+i+k,(h?h:r.y)-q/2+(o&&!m?0:j/2),r.y+q/2-(p!=C.length-1||m?j/2:0)];if(s.label){var u=Smits.PhyloCanvas.Render.Style.getStyle(s.labelStyle,"text"),w=a((t[0]+t[1])/2,(t[2]+t[3])/2),x=b((t[2]+t[3])/2),z=e(x[0]+(u.rotate?parseFloat(u.rotate):0)),A=e(90-(t[2]+t[3])/2-y);A>90&&270>A&&(z+=180),u["text-anchor"]||(u["text-anchor"]="middle");var B=l.draw(new Smits.PhyloCanvas.Render.Text(w[0],w[1],s.label,{attr:u,rotate:z}));B[0].toBack()}if(s.borderStyle){var D=Smits.PhyloCanvas.Render.Style.getStyle(s.borderStyle,"textSecantBg"),E=[v,D.fullsize?t[1]:t[0],t[2],t[3]],F=l.draw(new Smits.PhyloCanvas.Render.Path(f(E),{attr:D}));F[0].toBack()}var G=l.draw(new Smits.PhyloCanvas.Render.Path(f(t),{attr:s}));G[0].toBack(),h=0,o=!1}o=!1}return n?c:c+i+k}function k(a,b,c){for(var d,e=[],g=c&&c.bufferInner?parseFloat(c.bufferInner):Smits.PhyloCanvas.Render.Parameters.barChartBufferInner,h=c&&c.height?parseFloat(c.height):Smits.PhyloCanvas.Render.Parameters.barChartHeight?Smits.PhyloCanvas.Render.Parameters.barChartHeight:0,i=c&&c.width?parseFloat(c.width)<1?q*parseFloat(c.width):parseFloat(c.width):0|(Smits.PhyloCanvas.Render.Parameters.barChartWidth<1?q*Smits.PhyloCanvas.Render.Parameters.barChartWidth:Smits.PhyloCanvas.Render.Parameters.barChartWidth),j=0,k=0;k<C.length;k++)e.push(C[k].chart[b]);d=Math.max.apply(null,e),j=Smits.Common.roundFloat(h/d,4);for(var k=0;k<C.length;k++){var m=C[k];m.chart[b]>0&&l.draw(new Smits.PhyloCanvas.Render.Path(f(a+g,a+g+j*m.chart[b],m.y-i/2,m.y+i/2),{attr:Smits.PhyloCanvas.Render.Style.getStyle(m.chart[b],"barChart")}))}return a+g+h}var l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=Smits.PhyloCanvas.Render.Parameters.Circular,A=!0,B=0,C=[],D=[],E=0,F=Math.PI/180;return function(a,b,c){if(this.getCanvasSize=function(){return[m,n]},this.getRoot=function(){return b.getRoot()},b.getValidate())return a.draw({type:"text",x:0,y:a.canvasSize[1]/3,text:b.getValidate()}),void 0;l=a;var d=b.getRoot(),e=b.getNewickLen();if(m=l.canvasSize[0],n=l.canvasSize[1],t=m/2,u=n/2,o=Math.min.apply(null,[m,n]),c=z.bufferRadius>1?z.bufferRadius:Smits.Common.roundFloat(o*z.bufferRadius,4),w=z.bufferAngle,s=z.innerCircleRadius,r=z.minHeightBetweenLeaves,y=z.initStartAngle,v=Math.round((o-c-s)/2),p=(v-s)/e,q=Smits.Common.roundFloat((360-w)/d.getCountAllChildren(),4),g(d,s),x=v+E+z.bufferOuterLabels,Smits.PhyloCanvas.Render.Parameters.integratedBinaryCharts.length){var f=Smits.PhyloCanvas.Render.Parameters.integratedBinaryCharts;for(var h in f){var A=f[h].bufferInner?f[h].bufferInner:Smits.PhyloCanvas.Render.Parameters.binaryChartBufferInner,B=f[h].thickness?f[h].thickness:Smits.PhyloCanvas.Render.Parameters.binaryChartThickness;x=j(x-B-A,f[h].chart,f[h])}}if(x=i(),Smits.PhyloCanvas.Render.Parameters.binaryCharts.length){var C=Smits.PhyloCanvas.Render.Parameters.binaryCharts;for(var h in C)x=j(x,C[h].chart,C[h])}if(Smits.PhyloCanvas.Render.Parameters.barCharts.length){var D=Smits.PhyloCanvas.Render.Parameters.barCharts;for(var h in D)x=k(x,D[h].chart,D[h])}}}(),Smits.PhyloCanvas.Render.CircularPhylogram.prototype={};var XMLObjectifier=function(){var a=function(a){var b="";a&&"string"==typeof a&&(b=a);var c=/^((-)?([0-9]*)((\.{0,1})([0-9]+))?$)/;return c.test(b)},b={xmlToJSON:function(b){function c(a){return a.replace(/^\s+|\s+$/gm,"")}function d(a){var b=/-/g,c=String(a).replace(b,"_");return c}function e(a,b){if(b.attributes.length>0){var e,f=b.attributes.length-1;a._attributes=[];do e=String(d(b.attributes[f].name)),a._attributes.push(e),a[e]=c(b.attributes[f].value);while(f--)}}function f(b){b.getNodeByAttribute=function(a,b){if(this.length>0){var c,d=this.length-1;try{do if(c=this[d],c[a]==b)return c;while(d--)}catch(e){return!1}return!1}},b.contains=function(a,b){if(this.length>0){var c=this.length-1;try{do if(this[c][a]==b)return!0;while(c--)}catch(d){return!1}return!1}},b.indexOf=function(a,b){var c=-1;if(this.length>0){var d=this.length-1;try{do this[d][a]==b&&(c=d);while(d--)}catch(e){return-1}return c}},b.SortByAttribute=function(b,c){function d(b,c){var d=b[c];return d=a(d)?parseFloat(d):d}function e(a,e){var f,g,h=0;return f=d(a,b),g=d(e,b),g>f?h=-1:f>g&&(h=1),c&&(h="DESC"==c.toUpperCase()?0-h:h),h}this.length&&this.sort(e)},b.SortByValue=function(b){function c(b){var c=b.Text;return c=a(c)?parseFloat(c):c}function d(a,d){var e,f,g=0;return e=c(a),f=c(d),f>e?g=-1:e>f&&(g=1),b&&(g="DESC"==b.toUpperCase()?0-g:g),g}this.length&&this.sort(d)},b.SortByNode=function(b,c){function d(b,c){var d=b[c][0].Text;return d=a(d)?parseFloat(d):d}function e(a,e){var f,g,h=0;return f=d(a,b),g=d(e,b),g>f?h=-1:f>g&&(h=1),c&&(h="DESC"==c.toUpperCase()?0-h:h),h}this.length&&this.sort(e)}}function g(a,b){var h,i,j,k="";if(!b)return null;if(b.attributes.length>0&&e(a,b),a.Text="",b.hasChildNodes()){var l=b.childNodes.length-1,m=0;do switch(i=b.childNodes[m],i.nodeType){case 1:a._children=[],h=i.localName?i.localName:i.baseName,h=d(h),k!=h&&a._children.push(h),a[h]||(a[h]=[]),j={},a[h].push(j),i.attributes.length>0&&e(j,i),a[h].contains||f(a[h]),k=h,i.hasChildNodes()&&g(j,i);break;case 3:a.Text+=c(i.nodeValue);break;case 4:a.Text+=i.text?c(i.text):c(i.nodeValue)}while(m++<l)}}try{if(!b)return null;var h={};h.typeOf="JSXBObject";var i=9==b.nodeType?b.documentElement:b;return h.RootName=i.nodeName||"",3==b.nodeType||4==b.nodeType?b.nodeValue:(function(){var a={activate:function(){var a=[];return a&&(a.getNodesByAttribute=function(b,c){if(a&&a.length>0){var d,e=[],f=a.length-1;try{do d=a[f],d[b]===c&&e.push(d);while(f--);return e.reverse(),e}catch(g){return null}return null}},a.getNodeByAttribute=function(b,c){if(a&&a.length>0){var d,e=a.length-1;try{do if(d=a[e],d[b]===c)return d;while(e--)}catch(f){return null}return null}},a.getNodesByValue=function(b){if(a&&a.length>0){var c,d=[],e=a.length-1;try{do c=a[e],c.Text&&c.Text===b&&d.push(c);while(e--);return d}catch(f){return null}return null}},a.contains=function(b,c){if(a&&a.length>0){var d=a.length-1;try{do if(a[d][b]===c)return!0;while(d--)}catch(e){return!1}return!1}},a.indexOf=function(b,c){var d=-1;if(a&&a.length>0){var e=a.length-1;try{do a[e][b]===c&&(d=e);while(e--)}catch(f){return-1}return d}},a.SortByAttribute=function(b,c){function d(a,b){var c=a[b];return c=bam.validation.isNumeric(c)?parseFloat(c):c}function e(a,e){var f,g;f=d(a,b),g=d(e,b);var h=g>f?-1:f>g?1:0;return c&&(h="DESC"===c.toUpperCase()?0-h:h),h}a&&a.length>0&&a.sort(e)},a.SortByValue=function(b){function c(a){var b=a.Text;return b=bam.validation.isNumeric(b)?parseFloat(b):b}function d(a,d){var e,f;e=c(a),f=c(d);var g=f>e?-1:e>f?1:0;return b&&(g="DESC"===b.toUpperCase()?0-g:g),g}a&&a.length>0&&a.sort(d)},a.SortByNode=function(b,c){function d(a,b){var c=a[b][0].Text;return c=bam.validation.isNumeric(c)?parseFloat(c):c}function e(a,e){var f,g;f=d(a,b),g=d(e,b);var h=g>f?-1:f>g?1:0;return c&&(h="DESC"===c.toUpperCase()?0-h:h),h}a&&a.length>0&&a.sort(e)}),a}};return a}(),g(h,i),b=null,i=null,h)}catch(j){return null}},textToXML:function(a){var b=null;try{b=document.all?new ActiveXObject("Microsoft.XMLDOM"):new DOMParser,b.async=!1}catch(c){throw new Error("XML Parser could not be instantiated")}var d;try{d=document.all?b.loadXML(a)?b:!1:b.parseFromString(a,"text/xml")}catch(c){throw new Error("Error parsing XML string")}return d}};return b}();